<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>Material Login Form</title>


    <link rel="stylesheet" href="public/logIn/css/reset.css">

    <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900|RobotoDraft:400,100,300,500,700,900'>
    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>

    <link rel="stylesheet" href="public/logIn/css/style.css">
  </head>

  <body>
    <!-- Mixins-->
    <!-- Pen Title-->
    <div class="pen-title">
      <h1>Quick Write</h1>
      <span>Quick Write by <a href='http://unnc-cs-grp-dtgroup.github.io/Notebook-NW.js/'>GRPDT</a>
      </span>
    </div>
    <div class="rerun"><a href="http://unnc-cs-grp-dtgroup.github.io/Notebook-NW.js/">Quick Write page</a></div>
    <div class="container">
      <div class="card"></div>
      <div class="card">
        <h1 class="title">Login</h1>
        <form>
          <div class="input-container">
            <input type="text" id="Username" required="required"/>
            <label for="Username">Username</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="Password" required="required"/>
            <label for="Password">Password</label>
            <div class="bar"></div>
          </div>
          <div class="button-container">
            <button id="loginBtn"><span>Sign in</span></button>
          </div>
          <div class="footer"><a href="#">Forgot your password?</a></div>
        </form>
      </div>
      <div class="card alt">
        <div class="toggle"></div>
        <h1 class="title">Register
          <div class="close"></div>
        </h1>
        <form>
          <div class="input-container">
            <input type="text" id="Username2" required="required"/>
            <label for="Username">Username</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="Password2" required="required"/>
            <label for="Password">Password</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="Repeat Password" required="required"/>
            <label for="Repeat Password">Repeat Password</label>
            <div class="bar"></div>
          </div>
          <div class="button-container">
            <button id="regBtn"><span>Register</span></button>
          </div>
        </form>
      </div>
    </div>
    <!-- Portfolio-->
    <!-- <a id="portfolio" href="http://andytran.me/" title="View my portfolio!"><i class="fa fa-link"></i></a> -->
    <!-- CodePen-->
    <!-- <a id="codepen" href="http://codepen.io/andytran/" title="Follow me!"><i class="fa fa-codepen"></i></a> -->
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="public/logIn/js/index.js"></script> 
    <script src="public/data/localForage-1.4.0/dist/localforage.js"></script>
    
<!--    Log in-->
    <script>
    var allAppData = {};
    // sign in 被click时
    $("#loginBtn").click(function(e){
        e.preventDefault();
        var email = $("#Username").val();
        var pwd = $("#Password").val();
        localStorage.email = email;
        localStorage.password = pwd;
        
//        本地check
        localforage.getItem('allAppData', function(err, value) {
            allAppData = value;
            if(allAppData != null) { // 如果本地有数据
                console.log("get allAppData: " + value);
                console.log(email);
                console.log(pwd);
                console.log("right " + allAppData.UserInfo.Email);
                console.log("right " + allAppData.UserInfo.Password);
                if(allAppData.UserInfo.Email == email && allAppData.UserInfo.Password == pwd) {
                    location.href = "Untitled.html";
                }
                else { // 与本地数据不匹配
//                    alert("Wrong password");
                }
            }
            else { // 如果本地没数据：从server端check
                
            }
        });
//        var captcha = $("#captcha").val()
//        if(!email) {
//            showMsg("input username", "email");
//            return;
//        }
//        if(!pwd) {
//            showMsg("Password is required", "pwd");
//            return;
//        } else {
//            if(pwd.length < 6) {
//                showMsg("Wrong password", "pwd");
//                return;
//            }
//        }
//        if(needCaptcha && !captcha) {
//            showMsg("Captcha is required", "captcha");
//            return;
//        }

        $("#loginBtn").html("Sign in...").addClass("disabled");

//        document.cookie = "LEANOTE_SESSION=; expires=" + (new Date(0).toUTCString()) + ';domain=leanote.com; path=/';
//
//        document.cookie = "LEANOTE_SESSION=; expires=" + (new Date(0).toUTCString()); 

//            server check
//        $.post("/doLogin", {email: email, pwd: pwd, captcha: $("#captcha").val()}, function(e) {
//            $("#loginBtn").html("Sign in").removeClass("disabled");
//            if(e.Ok) {
//                $("#loginBtn").html("login success...");
//    //				var from = $("#from").val() || "/note";
//    //				location.href = from;
//                location.href = "Untitled.html";
//            } else {
//                if(e.Item && $.trim($("#captchaContainer").text()) == "") {
//                    $("#captchaContainer").html($("#tCaptcha").html());
//                    needCaptcha = true
//                }
//
//                showMsg(e.Msg);
//            }
//        });
    });
    </script>
      
<!--      Register-->
    <script>
        $("#regBtn").click(function(e){
            e.preventDefault();
            var email = $("#Username2").val();
            var pwd = $("#Password2").val();
            var jsonData = {"Email": email, "Password": pwd};
            var stringifiedJson = JSON.stringify(jsonData);
            var url = 'http://cs-linux.nottingham.edu.cn:8000/register';
            $.ajax({
                type: 'POST', // added,
                url: url,
                data: stringifiedJson,
                contentType: "text/plain",
                success: function (data) {
        //                    var ret = jQuery.parseJSON(data);
        //                    $('#lblResponse').html(ret.msg);
                    console.log(JSON.parse(data).msg);
                },
                error: function (xhr, status, error) {
                    alert('Error: ' + error.message);
                }
            });

      
      </script>
  </body>
</html>
