
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>QUnit Example</title>
<script src="dep.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-1.23.0.css">
<script src="https://code.jquery.com/qunit/qunit-1.23.0.js"></script>
<script src="msg.en.js"></script>
<script src="../public/data/localForage-1.4.0/dist/localforage.js"></script>
<script type="">
	
	var baseUrl = "http:\/\/115.28.134.156:3000\/";
    var LEA = {};
    LEA.sPath = "https:\/\/dn-leanote.qbox.me";
    LEA.locale = "en";
    var UrlPrefix = 'http:\/\/leanote.com';
    var GlobalConfigs = {"uploadAttachSize":0,"uploadAvatarSize":0,"uploadBlogLogoSize":0,"uploadImageSize":0};
//    var tinyMCEPreInit = {base: 'https:\/\/dn-leanote.qbox.me/tinymce_4.1.9/js/tinymce', suffix: '.min'};
    var curNoteId = "";
    var curNotebookId = "";
    var curSharedNoteNotebookId = "";
    var curSharedUserId = "";
    var noteContentJson = [];

    //需要同步的初始数据
    var UserInfo = {"UserId":"","Email":"me@nottingham.edu.cn","Verified":false,"Username":"unknown","UsernameRaw":"","CreatedTime":"0001-01-01T00:00:00Z","Logo":"http://leanote.com/images/blog/default_avatar.png","Theme":"","NotebookWidth":0,"NoteListWidth":0,"MdEditorWidth":0,"LeftIsMin":false,"ThirdUserId":"","ThirdUsername":"","ThirdType":0,"FromUserId":"","NoteCnt":0,"Usn":10,"FullSyncBefore":"0001-01-01T00:00:00Z","BlogUrl":"","PostUrl":"", "Password":"unknown"};

    var notebooks = [];

    var shareNotebooks = {};
    
    var sharedUserInfos = [];
    
    var shareNotebookDefault = {};

    var notes = [];

    var latestNotes = [];

    var tagsJson = [];

    var trackingLog = [];
    
    var allAppData = {};
    
    //initial data    
    allAppData.UserInfo = UserInfo;
    allAppData.notebooks = notebooks;
    allAppData.shareNotebooks = shareNotebooks;
    allAppData.sharedUserInfos = sharedUserInfos;
    allAppData.notes = notes;
    allAppData.latestNotes = latestNotes;
    allAppData.tagsJson = tagsJson;
    allAppData.trackingLog = trackingLog;
    allAppData.shareNotebookDefault = shareNotebookDefault;
</script>
<script src="app.min.js"></script>


<style>body { width: 500px; margin-left: auto; margin-right: auto; background-color: #f0f3f9; }</style>
<script type="text/javascript">
	
</script>

<script type="text/javascript">
	
    function sleep(miliseconds) {
       var currentTime = new Date().getTime();

       while (currentTime + miliseconds >= new Date().getTime()) {
       }
    }
</script>   

<script>
asyncTest("Save into local storage", function() {
    
//    there are two notebooks
    Notebook.doAddNotebook("Notebook1", "testNotebook1", "");
    Notebook.doAddNotebook("-1", "trash", "");
    
    ok(2 == Object.getOwnPropertyNames(Notebook.cache).length, "2 notebooks created successfully");
    ok("testNotebook1" == Notebook.cache["Notebook1"].Title, "2 notebooks created successfully");
    ok("trash" == Notebook.cache["-1"].Title, "2 notebooks created successfully");
    
//    there are 2 notes
    Note.newNote("Notebook1");
    Note.newNote("Notebook1");
    ok(2 == Object.getOwnPropertyNames(Note.cache).length, "2 notes created successfully");

//    there are 1 tag
    var newTag = {
        Count: 1,
        CreatedTime: getCurDate(),
        IsDeleted: false,
        Tag: "Red",
        TagId: "testTag1",
        UpdatedTime: getCurDate(),
        UserId: "",
        Usn: 94
    };
    Tag.addTagNav(newTag);
    ok(1 == Tag.tags.length, "1 tag created successfully!");
    
    saveIntoLocal();
    localforage.getItem('allAppData', function(err, value) {
        if(value != null) { //如果本地有数据，使用本地的
            allAppData = value;
            UserInfo = allAppData.UserInfo;
            notebooks = allAppData.notebooks;
            shareNotebooks = allAppData.shareNotebooks;
            sharedUserInfos = allAppData.sharedUserInfos;
            notes = allAppData.notes;
            latestNotes = allAppData.latestNotes;
            tagsJson = allAppData.tagsJson;
            trackingLog = allAppData.trackingLog;
            shareNotebookDefault = allAppData.shareNotebookDefault;

            ok(2 == notebooks.length, "Notebooks in the local storage are right");
            ok(2 == notes.length, "Notes in the local storage are right");
            ok(2 == tagsJson.length, "Tags in the local storage are right");
        }
    });
});

asyncTest("Server side", function() {
    
})
</script>
</head>

<body>
<div id="qunit"></div>
 <div id="qunit-fixture"></div>
</body>
</html>
